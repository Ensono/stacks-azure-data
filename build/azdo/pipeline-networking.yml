name: "$(Build.SourceBranchName)-networking"

# This pipeline is for manual runs only - PR validation uses pipeline-full-deployment.yml
trigger: none
pr: none

parameters:
  - name: destroy
    displayName: Destroy Environment
    type: boolean
    default: false

  - name: deploy
    displayName: Deploy Environment
    type: boolean
    default: true

  - name: debug
    displayName: Enable Debug
    type: boolean
    default: false

  - name: vmss_ssh_key
    displayName: ADO Agent SSH Key
    type: string
    default: " "

  - name: environment
    displayName: Environment Group
    type: string
    default: nonprod
    values:
      - nonprod
      - prod

# Define the stages of the networking deployment pipeline
stages:
  - stage: Networking
    variables:
      - template: variables.yml
        parameters:
          environment: ${{ parameters.environment }}
      - name: STAGE
        value: networking
      - name: TF_FILE_LOCATION
        value: /eirctl/deploy/terraform/networking
      - name: ENV_NAME
        value: ${{ parameters.environment }}

    jobs:
      - job: Deploy
        pool:
          vmImage: "ubuntu-latest"

        steps:
          - template: templates/terraform-networking.yml
            parameters:
              destroy: ${{ parameters.destroy }}
              deploy: ${{ parameters.deploy }}
